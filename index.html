<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laporan Upload Soal â€“ Simpel</title>
  <style>
    body{font-family:Arial, sans-serif; margin:0; background:#f2f4f7; color:#333}
    header{background:#4f46e5; color:white; padding:28px 20px; text-align:center}
    h1{margin:0; font-size:1.6rem}

    .container{max-width:900px; margin:auto; padding:16px}

    .summary{display:flex; gap:10px; flex-wrap:wrap; margin-top:18px}
    .box{flex:1; min-width:150px; background:white; padding:16px; border-radius:10px; text-align:center; box-shadow:0 3px 10px rgba(0,0,0,0.08)}
    .box h3{margin:0; font-size:0.9rem; color:#555}
    .box p{margin-top:6px; font-size:1.4rem; font-weight:bold; color:#111}

    .panel{background:white; padding:16px; border-radius:10px; margin-top:20px; box-shadow:0 3px 10px rgba(0,0,0,0.05)}

    table{width:100%; border-collapse:collapse; margin-top:12px; font-size:0.92rem}
    th,td{padding:10px; border-bottom:1px solid #eee; text-align:left}
    th{background:#f9fafb; font-weight:bold}

    input{width:100%; padding:10px; border-radius:8px; border:1px solid #ccc}

    .small{font-size:0.8rem; color:#777; margin-top:8px}
  </style>
</head>
<body>
<header>
  <h1>ðŸ“Š Laporan Upload Soal</h1>
  <p style="margin-top:6px">Update otomatis dari Google Sheet</p>
</header>

<div class="container">

  <!-- Summary -->
  <div class="summary">
    <div class="box"><h3>Total Upload</h3><p id="totalUploads">â€”</p></div>
    <div class="box"><h3>Total Kelas</h3><p id="totalClasses">â€”</p></div>
    <div class="box"><h3>Total Soal</h3><p id="totalQuestions">â€”</p></div>
  </div>

  <div class="panel">
    <input id="search" placeholder="Cari guru, mapel, kelas..." />
    <table>
      <thead>
        <tr>
          <th>Jam Upload</th>
          <th>Nama Guru</th>
          <th>Mapel</th>
          <th>Kelas</th>
          <th>Soal</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

<style>
.checked {
  color: green;
  font-weight: bold;
  font-size: 20px;
}
</style>
<script>
function checkLinks(){
  const rows = document.querySelectorAll("table tbody tr");
  rows.forEach(row => {
    [3,4,5].forEach(i => {
      const cell = row.children[i];
      if(cell && cell.textContent.trim().length > 0){
        cell.innerHTML = '<span class="checked">âœ”</span>';
      }
    });
  });
}
setTimeout(checkLinks, 1000);
</script>
    <p class="small">Terakhir update: <span id="lastUpdate">â€”</span></p>
  </div>

</div>

<script>
const SHEET_ID = "1eMO8-evONR5nk8_0k5hBEKF8ZYXcCC-h1htBC7h4RVs";
const SHEET_NAME = "Rekap";
let allData = [];

async function loadData(){
  try{
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;
    const raw = await fetch(url).then(r=>r.text());
    const json = JSON.parse(raw.substring(raw.indexOf('{'), raw.lastIndexOf('}')+1));

    const rows = json.table.rows.map(r => r.c.map(c => c? c.v : ""));

    allData = rows;
    render(rows);
  }catch(e){console.error(e);}
}

function render(data){
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  data.forEach(r => {
    const tr = document.createElement("tr");
    r.forEach(col => {
      const td = document.createElement("td");
      td.textContent = col;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  document.getElementById("totalUploads").textContent = data.length;
  document.getElementById("totalClasses").textContent = new Set(data.map(r=>r[3])).size;
  document.getElementById("totalQuestions").textContent = data.reduce((a,b)=>a+(parseInt(b[4])||0),0);

  document.getElementById("lastUpdate").textContent = new Date().toLocaleString("id-ID");
}

document.getElementById("search").addEventListener("input", e=>{
  const v = e.target.value.toLowerCase();
  const filtered = allData.filter(r => r.join(" ").toLowerCase().includes(v));
  render(filtered);
});

loadData();
</script>
</body>
</html>
